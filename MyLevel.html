<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit">
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-title" content="Amaze UI" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>台湾名品女装</title>
		<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
		<script type="text/javascript" src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
		<link rel="stylesheet" href="css/ydui.css">
		<link rel="stylesheet" href="css/app.css" />
		<link rel="stylesheet" href="fonts/iconfont.css" />
		<script src="js/ydui.flexible.js"></script>
		<script type="text/javascript" src="js/Common.js"></script>
		<link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_1626290_fexhyvwyls5.css" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mescroll.js@1.4.1/mescroll.min.css">
		<script src="https://cdn.jsdelivr.net/npm/mescroll.js@1.4.1/mescroll.min.js" charset="utf-8"></script>
		<script src="https://at.alicdn.com/t/font_1626290_fexhyvwyls5.js"></script>
		<link rel="stylesheet" href="css/mobileselect.css" />
		<script type="text/javascript" src="js/mobileselect.min.js"></script>
		<script type="text/javascript" src="js/selectdate.js"></script>
		<style>
			body{
				height: 100%;

			}
			.tab-nav-item:not(:last-child):after{
				border-right: none;
			}
			.tab-nav-item.tab-active:before{
				background-color: #C39666;
			}
			.tab-nav-item a{
				font-family:PingFangSC-Medium,PingFang SC;
				color:rgba(51,51,51,1);
			}
			.tab-panel-item{
				height: 100%;
				background-color: #F5F5F5;
				padding: 0 !important;
			}
			.tab-panel{
				background: #F5F5F5;
			}
			#type1{
				padding-top: .2rem;
			}
			.m-cell{
				width: 96%;
				margin-left: 2%;
				margin-top: .2rem;
				border-radius: .1rem;
				margin-bottom: .2rem;
			}
			.cell-select{
				height: 0.8rem;
				color: #333333;
				font-size: .38rem;
			}
			#type1 .t1_a2 .cell-right{
				min-height: .8rem;
			}
			#type1 .m-cell:after{
				border: none;
			}
			.t1_a1 img{
				width: .8rem;
				padding-top: .2rem;
				padding-bottom: .2rem;
				margin-right: .2rem;
			}
			.t1_a2{
				font-size: .2rem;
			}
			.t1_a2 .cell-left{
				font-size: .22rem;
				color: #C39666;
				font-size: .38rem;
			}
			.t1_a2 .cell-right{
				font-size: .22rem;
				color: #C39666;
				font-size: .38rem;
			}
			#type2 .t1_a2 .cell-right{
				min-height: .8rem;
			}
			.cell-left{
				font-size: .38rem;
			}
			.cell-right{
				font-size: .38rem;
			}
			#selectdate{
				position: absolute;
				width: .23rem;
				height: .12rem;
				left:1.3rem;
				top: .32rem;
			}
			#seldate:after{
				border: none;
			}
			.m-grids-3 .grids-item:not(:nth-child(3n)):before{
				border:none;
			}
			.grids-item{
				padding: .1rem 0;
				
			}
			.grids-txt p{
				font-size: .35rem;
			}
			.grids-item:after,.m-grids-3:before{
				border: none;
			}
			#h2_total{
				font-size: .38rem;
			}
			#h2_total:after{
				border-bottom: none;
			}
			.t1_a2 .cell-left{
				font-size: .3rem;
				color: #333333;
			}
		</style>
	</head>
	<body>
		<header class="m-navbar">
			<a href="MyInfo.html"  class="navbar-item">
				<i class="back-ico"></i>
			</a>
			<div class="navbar-center">
				<span class="navbar-title">我的代理</span>
			</div>
		</header>
		<header id="seldate" class="m-navbar">
			<a href="#" class="navbar-item seldatetime ">
				<i class="back-ico"></i>
			</a>
			<div class="navbar-center ">
				<span class="" id="select_date" style="font-size: .42rem;" class="navbar-title">本月</span>
			</div>
		</header>
		<header class="m-navbar" id="h2_total">
			<a href="#" class="navbar-item" style="font-size: .42rem;">
			</a>
			<div class="navbar-center">
				<span class="navbar-title" id="span_total" style="font-size: .4rem;"></span>
			</div>
			<a href="#" class="navbar-item" style="font-size: .42rem;">
		
			</a>
		</header>
			<div class="m-grids-3" style="margin-bottom: .15rem;">
				<a href="#" class="grids-item">
					<div class="grids-txt">
						<p>利润</p>
						<p id="profit"></p>
					</div>
				</a>
				<a href="#" class="grids-item">
					<div class="grids-txt">
						<p>奖金</p>
						<p id="bounty"></p>
					</div>
				</a>
				<a href="#" class="grids-item">
					<div class="grids-txt">
						<p>销售折扣</p>
						<p id="team_money"></p>
					</div>
				</a>
			</div>
			<header class="m-navbar">
				<a href="#" class="navbar-item" style="font-size: .42rem;">
					业绩
				</a>
				<div class="navbar-center">
					<span class="navbar-title"></span>
				</div>
				<a href="#" class="navbar-item" id="total_sales" style="font-size: .42rem;">
		
				</a>
			</header>
		<div id="J_Tab" class="m-tab">
		    <ul class="tab-nav">
				<li class="tab-nav-item tab-active"><a href="javascript:;" id='tab_type1'>直属代理</a></li>
				<li class="tab-nav-item"><a href="javascript:;" id='tab_type2'>分销商</a></li>
		    </ul>
		    <div class="tab-panel">
				<div class="tab-panel-item tab-active" id='type1'>
					<div class="m-cell">
						<div class="cell-item">
							<div class="cell-left">代理等级：</div>
							<label class="cell-right cell-arrow">
								<select class="cell-select level_info">
									<option value="">全部</option>
									
								</select>
							</label>
						</div>
					</div>
					<ul id="type1_ul">
						<!-- <li>
							<div class="m-cell type1_list">
							    <a class="cell-item t1_a1"  href="javascript:;">
							        <div class="cell-left"><img src="img/info/grxx.png">毛毛代理</div>
							        <div class="cell-right">一级代理</div>
							    </a>
							    <a class="cell-item t1_a2" href="javascript:;">
							        <div class="cell-left">查看订单</div>
							        <div class="cell-right">查看下级</div>
							    </a>
							</div>
						</li> -->
					</ul>
					
					
					
				</div>
				<div class="tab-panel-item" id='type2'>
					<div class="m-cell">
						<div class="cell-item">
							<div class="cell-left">代理等级：</div>
							<label class="cell-right cell-arrow">
								<select class="cell-select level_info2">
									<option value="">全部</option>
									
								</select>
							</label>
						</div>
					</div>
					<ul id="type2_ul">
						<!-- <li>
							<div class="m-cell type1_list">
							    <a class="cell-item t1_a1"  href="javascript:;">
							        <div class="cell-left"><img src="img/info/grxx.png">毛毛代理</div>
							        <div class="cell-right">一级代理</div>
							    </a>
							    <a class="cell-item t1_a2" href="javascript:;">
							        <div class="cell-left">团队销售总额:3134.00</div>
							        <div class="cell-right"></div>
							    </a>
							</div>
							</li> -->
							
					</ul>
					
					
					
					
				</div>
		    </div>
		</div>

		<script type="text/javascript" src="js/ydui.js"></script>
		<script>

			var dialog = window.YDUI.dialog;
			
			var token =userinfo.token;
			var user_id = userinfo.user_id;
			var $tab = $('#J_Tab');
			var level_id;
			$tab.tab({
				nav: '.tab-nav-item',
				panel: '.tab-panel-item',
				activeClass: 'tab-active'
			});

			$tab.find('.tab-nav-item').on('open.ydui.tab', function (e) {
				if(e.index==0){
					getmyLevel(1);
				}else if(e.index==1){
					getmyLevel(2);
				}
				
				// console.log('索引：%s - [%s]正在打开', e.index, $(this).text());
			});

			// $tab.find('.tab-nav-item').on('opened.ydui.tab', function (e) {
			// 	getmyLevel(2);
			// 	console.log('索引：%s - [%s]已经打开了', e.index, $(this).text());
			// });
			
			function getLevelinfo(){
				$.ajax({
					type: "get",
					url: ajaxUrl + '/user/level_info',
					dataType: "json",
					success: function(res) {
						if (res.code == 1) {
							let html="";
							let data=res.data
							for(let i=0;i<data.length;i++){
								html+="<option value='"+data[i].id+"'>"+data[i].nickname+"</option>"
							}
							$(".level_info").append(html);
							$(".level_info2").append(html);
						} else {
							dialog.toast(res.msg, 'none', 1000);
						}
					},
					error: function(err) {
						dialog.toast('获取代理基本信息失败，服务异常！', 'none', 1000);
					}
				})
			}
			
			function getmyLevel(type){
				var formData = new FormData();
				formData.append("token", token);
				formData.append("user_id", user_id);
				formData.append("type", type);
				formData.append("level_id", level_id==null||level_id==undefined?"":level_id);
				formData.append("date", $("#select_date").text());
				$.ajax({
					type: "post",
					url: ajaxUrl + '/user/agency_list',
					data: formData,
					cache: false,
					processData: false,
					contentType: false,
					dataType: "json",
					success: function(res) {
						if (res.code == 1) {
							
							$("tab_type1").text('直属代理('+res.data.agency_1_num+')');
							$("tab_type2").text('直属代理('+res.data.agency_2_num+')');
							let header = res.data.header;
							$("#bounty").text(header.bounty);
							$("#profit").text(header.profit);
							$("#team_money").text(header.team_money);
							$("#total_sales").text("￥" + header.total_sales);
							
							let total = comdify(Number(header.bounty) + Number(header.profit) + Number(header.team_money));
							$("#span_total").text("￥" + total);
							if (type == 1) {
								let html="";
								let data=res.data.agency_data;
								for(let i=0;i<data.length;i++){
									html+="<li>";
									html+="<div class='m-cell type1_list'>";
									html+="<a class='cell-item t1_a1'  href='javascript:;'>";
									html+="<div class='cell-left'><img src='"+data[i].avatar+"'>"+data[i].nickname+"</div>";
									html+="<div class='cell-right'>"+data[i].level_name+"</div>";
									html+="</a>";
									html+="<a class='cell-item t1_a2' href='javascript:;'>";
									//html+="<div class='cell-left' onclick='OrderDetail("+data[i].user_id+")'>查看订单</div>";
									html+="<div class='cell-left' >货款："+data[i].goods_payment+" 销售额："+data[i].team_money+" </div>";
									html+="<div class='cell-right' onclick='Agencychild("+data[i].user_id+")'>个人信息</div>";
									html+="</a>";
									html+="</div>";
									html+="</li>";
								}
								$("#type1_ul").empty();
								$("#type1_ul").append(html);
							} else if (type == 2) {
								let html="";
								let data=res.data.agency_data;
								for(let i=0;i<data.length;i++){
									html+="<li>";
									html+="<div class='m-cell type1_list'>";
									html+="<a class='cell-item t1_a1'  href='javascript:;'>";
									html+="<div class='cell-left'><img src='"+data[i].avatar+"'>"+data[i].nickname+"</div>";
									html+="<div class='cell-right'>"+data[i].level_name+"</div>";
									html+="</a>";
									html+="<a class='cell-item t1_a2' href='javascript:;'>";
									html+="<div class='cell-left'>团队销售总额："+data[i].team_money+"</div>";
									html+="<div class='cell-right'></div>";
									html+="</a>";
									html+="</div>";
									html+="</li>";
								}
								$("#type2_ul").empty();
								$("#type2_ul").append(html);
							}
						} else {
							dialog.toast(res.msg, 'none', 1000);
						}
					}
				})
			}
			function OrderDetail(userid){
				location.href="AgencyOrderList.html?userid="+userid;
			}
			function Agencychild(userid){
				//location.href="Agency_child_list.html?userid="+userid;
			}
			function reMonth(mon) {
				if (mon < 10) {
					mon = "0" + mon;
					return mon;
				}
			}
			
			var myDate = new Date();
			var tYear = myDate.getFullYear();
			
			var tMonth = myDate.getMonth() + 1;
			$("#select_date").html(tYear + "-" + reMonth(tMonth));
			$.selectDateSimple(".seldatetime", {
				start: tYear - 10,
				end: tYear,
				select: [tYear, tMonth]
			}, function(data) {
			
				$("#select_date").html(data.year + "-" + reMonth(data.month));
				let tabtype= $(".tab-nav").find(".tab-active a").attr("id").replace("tab_type",'');
				getmyLevel(tabtype)
			});
			
			$.selectDateSimple("#select_date", {
				start: tYear - 10,
				end: tYear,
				select: [tYear, tMonth]
			}, function(data) {
			
				$("#select_date").html(data.year + "-" + reMonth(data.month));
				let tabtype= $(".tab-nav").find(".tab-active a").attr("id").replace("tab_type",'');
				getmyLevel(tabtype)
			});
			
			
			$(function() {
				getLevelinfo()
				getmyLevel(1);
				$(".level_info").change(function(){
					level_id=$(".level_info").val();
					if($("#J_Tab ul").find('.tab-active').index()==0){
						getmyLevel(1);
					}else{
						getmyLevel(2);
					}
					
				})
				$(".level_info2").change(function(){
					level_id=$(".level_info2").val();
					if($("#J_Tab ul").find('.tab-active').index()==0){
						getmyLevel(1);
					}else{
						getmyLevel(2);
					}
					
				})
			})
		</script>


	</body>
</html>
